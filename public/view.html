<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</title>
    <link rel="stylesheet" href="style.css" />
    <style>
      .page {
        padding: 20px;
      }
      .delete-btn {
        background-color: transparent;
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <header class="main-header">
      <div class="logo-section">
        <img src="img/logo.webp" alt="Ø´Ø¹Ø§Ø± " class="logo" />
        <span class="site-name">My-Site</span>
      </div>
      <nav class="nav-links">
        <a href="form.html"> Form</a>
        <a href="view.html"> View</a>
        <a href="payment.html">Payment</a>
      </nav>
    </header>

    <div class="page">
      <h1>ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>
      <table id="dataTable">
        <thead>
          <tr>
            <th>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</th>
            <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
            <th>Ø§Ø´ØªØ±Ø§Ùƒ</th>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th>Ø§Ù„ÙˆÙ‚Øª</th>
            <th>Ø§Ù„Ø§Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div style="margin-top: 30px">
        <a href="form.html" style="color: white">ğŸ”™ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¶</a>
      </div>
    </div>

    <script>
      function formatDateOnly(dateString) {
        const date = new Date(dateString);
        return date.toISOString().split("T")[0]; // yyyy-mm-dd
      }

      function formatTimeOnly(dateString) {
        const date = new Date(dateString);
        return date.toTimeString().split(" ")[0]; // hh:mm:ss
      }

      function getData() {
        fetch("/data")
          .then((res) => res.json())
          .then((rows) => {
            const tbody = document.querySelector("#dataTable tbody");
            tbody.innerHTML = "";

            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù…
            rows.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            rows.forEach((row) => {
              const tr = document.createElement("tr");
              tr.innerHTML = `
                <td>${row.name}</td>
                <td>${row.email}</td>
                <td>${row.plan || ""}</td>
                <td>${formatDateOnly(row.createdAt)}</td>  <!-- Ø§Ù„ØªØ§Ø±ÙŠØ® -->
                <td>${formatTimeOnly(row.createdAt)}</td>  <!-- Ø§Ù„ÙˆÙ‚Øª -->
                <td><button class="delete-btn" onclick="deleteRow('${
                  row.id
                }')">âŒ</button></td>
              `;
              tbody.appendChild(tr);
            });
          });
      }

      function deleteRow(id) {
        if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ")) {
          fetch(`/delete/${id}`, { method: "DELETE" }).then((res) => {
            if (res.ok) {
              getData(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù
            } else {
              alert("ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­Ø°Ù.");
            }
          });
        }
      }

      window.onload = getData;
    </script>
  </body>
</html>
